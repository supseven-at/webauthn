(()=>{function c(e){let t=new Uint8Array(e),r="";for(let o of t)r+=String.fromCharCode(o);return btoa(r).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function h(e){let t=e.replace(/-/g,"+").replace(/_/g,"/"),r=(4-t.length%4)%4,n=t.padEnd(t.length+r,"="),o=atob(n),l=new ArrayBuffer(o.length),a=new Uint8Array(l);for(let i=0;i<o.length;i++)a[i]=o.charCodeAt(i);return l}function m(){return window?.PublicKeyCredential!==void 0&&typeof window.PublicKeyCredential=="function"}function E(e){let{id:t}=e;return{...e,id:h(t),transports:e.transports}}function A(e){return e==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(e)}var s=class extends Error{constructor(t,r="WebAuthnError"){super(t),this.name=r}};var d=class{createNewAbortSignal(){this.controller&&this.controller.abort("Cancelling existing WebAuthn API call for new one");let t=new AbortController;return this.controller=t,t.signal}},v=new d,C=["cross-platform","platform"];function S(e){if(e&&!(C.indexOf(e)<0))return e}function K(e){return new TextDecoder("utf-8").decode(e)}async function P(){let e=window.PublicKeyCredential;return e.isConditionalMediationAvailable!==void 0&&e.isConditionalMediationAvailable()}function D({error:e,options:t}){let{publicKey:r}=t;if(!r)throw Error("options was missing required publicKey property");if(e.name==="AbortError"){if(t.signal===new AbortController().signal)return new s("Authentication ceremony was sent an abort signal","AbortError")}else if(e.name!=="NotAllowedError"){if(e.name==="SecurityError"){let n=window.location.hostname;if(A(n)){if(r.rpId!==n)return new s(`The RP ID "${r.rpId}" is invalid for this domain`,"SecurityError")}else return new s(`${window.location.hostname} is an invalid domain`,"SecurityError")}else if(e.name==="UnknownError")return new s("The authenticator was unable to process the specified options, or could not create a new assertion signature","UnknownError")}return e}async function p(e,t=!1){var r,n;if(!m())throw new Error("WebAuthn is not supported in this browser");let o;((r=e.allowCredentials)===null||r===void 0?void 0:r.length)!==0&&(o=(n=e.allowCredentials)===null||n===void 0?void 0:n.map(E));let l={...e,challenge:h(e.challenge),allowCredentials:o},a={};if(t){if(!await P())throw Error("Browser does not support WebAuthn autofill");if(document.querySelectorAll("input[autocomplete*='webauthn']").length<1)throw Error('No <input> with `"webauthn"` in its `autocomplete` attribute was detected');a.mediation="conditional",l.allowCredentials=[]}a.publicKey=l,a.signal=v.createNewAbortSignal();let i;try{i=await navigator.credentials.get(a)}catch(w){throw D({error:w,options:a})}if(!i)throw new Error("Authentication was not completed");let{id:b,rawId:y,response:u,type:g}=i,f;return u.userHandle&&(f=K(u.userHandle)),{id:b,rawId:c(y),response:{authenticatorData:c(u.authenticatorData),clientDataJSON:c(u.clientDataJSON),signature:c(u.signature),userHandle:f},type:g,clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:S(i.authenticatorAttachment)}}(async function(){async function e(){let t=document.querySelector("#mfaController");try{let r=JSON.parse(t.querySelector("[data-auth-options]").dataset.authOptions),n=await p(r);console.log(n),t.querySelector("#credential").value=JSON.stringify(n),t.submit()}catch(r){console.error(r),t.querySelector("#webauthnFailure").classList.remove("hide")}}document.querySelectorAll("#mfaController [type=submit]").forEach(t=>{t.name="btnSubmit",t.addEventListener("click",async r=>{r.preventDefault(),await e()})}),await e()})();})();
